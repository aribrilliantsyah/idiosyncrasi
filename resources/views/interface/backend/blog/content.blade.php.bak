@extends('layouts.admin')
@push('plugin-styles')
<link href="{{ asset('/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet" type="text/css" />
<style type="text/css">
  .table thead tr th{
    vertical-align: middle;
    text-align: center;
  }
  .table tbody tr td{
    vertical-align: middle;
    text-align: center;
  }

  #m-datatable th, #m-datatable td {
    font-size: 13px;
  }
</style>
@endpush
@section('title')
BLOG 
@endsection
@section('bread')
	<ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
		<li class="m-nav__item m-nav__item--home">
			<a href="{{ url('/welcome') }}" class="m-nav__link m-nav__link--icon">
				<i class="m-nav__link-icon la la-home"></i>
			</a>
		</li>
		<li class="m-nav__separator">
			-
		</li>
		<li class="m-nav__item">
			<a class="m-nav__link">
				<span class="m-nav__link-text">
					Blog
				</span>
			</a>
		</li>
		<li class="m-nav__separator">
			-
		</li>
		<li class="m-nav__item">
			<a class="m-nav__link">
				<span class="m-nav__link-text">
					Konten
				</span>
			</a>
		</li>
	</ul>
@endsection
@section('content')
@php
function data_c($type){
	return App\content::where('jenis', $type)->first()->ket;
}
@endphp
<div class="row">
	<div class="col-sm-12">
		<div class="m-portlet m-portlet--mobile">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<h3 class="m-portlet__head-text">
							VISI & MISI
						</h3>
					</div>
				</div>
				<div class="m-portlet__head-tools">
				</div>
			</div>
			<div class="m-portlet__body">
				<div class="row">
					<div class="col-sm-6">
						<div class="m-portlet m-portlet--mobile">
							<div class="m-portlet__head">
								<div class="m-portlet__head-caption">
									<div class="m-portlet__head-title">
										<h3 class="m-portlet__head-text">
											VISI
										</h3>
									</div>
								</div>
								<div class="m-portlet__head-tools">
									<button onclick="save('visi')" class="btn btn-sm btn-accent m-btn--air m-btn--pill "><i class="fa fa-save"></i> Simpan</button>
								</div>
							</div>
							<div class="m-portlet__body">
								<textarea class="form-control editor" name="visi" id="c_visi">{{ data_c('visi') }}</textarea>
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="m-portlet m-portlet--mobile">
							<div class="m-portlet__head">
								<div class="m-portlet__head-caption">
									<div class="m-portlet__head-title">
										<h3 class="m-portlet__head-text">
											MISI
										</h3>
									</div>
								</div>
								<div class="m-portlet__head-tools">
									<button onclick="save('misi')"" class="btn btn-sm btn-accent m-btn--air m-btn--pill "><i class="fa fa-save"></i> Simpan</button>
								</div>
							</div>
							<div class="m-portlet__body">
								<textarea class="form-control editor" name="misi" id="c_misi">{{ data_c('misi') }}</textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-sm-12">
		<div class="m-portlet m-portlet--mobile">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<h3 class="m-portlet__head-text">
							QUOTES
						</h3>
					</div>
				</div>
				<div class="m-portlet__head-tools">
					<button onclick="save('quotes')" class="btn btn-sm btn-accent m-btn--air m-btn--pill "><i class="fa fa-save"></i> Simpan</button>
				</div>
			</div>
			<div class="m-portlet__body">
				<textarea class="form-control editor" name="quotes" id="c_quotes">{{ data_c('quotes') }}</textarea>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-sm-6">	
		<div class="m-portlet m-portlet--full-height ">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<h3 class="m-portlet__head-text">
							<div id="pager">
							      <ul id="pagination" class="pagination-sm"></ul>
							</div>
						</h3>
					</div>
				</div>
				<div class="m-portlet__head-tools">
					<button class="btn btn-sm btn-primary m-btn m-btn--icon m-btn--pill m-btn--air" type="button" onclick="addagenda()"><i class="fa fa-plus"></i> Tambah </button>
				</div>
			</div>
			<div class="m-portlet__body" id="agenda_content">
				{{-- 
				 --}}
			</div>
		</div>
	</div>
	<div class="col-sm-6">	
		<div class="m-portlet m-portlet--full-height ">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<h3 class="m-portlet__head-text">
							Kontak
						</h3>
					</div>
				</div>
				<div class="m-portlet__head-tools">
					<button class="btn btn-sm btn-accent m-btn m-btn--icon m-btn--pill m-btn--air" onclick="save_kontak('kontak')"><i class="fa fa-save"></i> Simpan </button>
				</div>
			</div>
			<div class="m-portlet__body">
				<form class="form" id="kontak" role="form">
					<div class="form-group">
						<div class="input-group">
							<span class="input-group-addon"><i class="fa fa-phone"></i></span>
							<input type="text" name="phone" class="form-control textbox" value="{{ data_c('phone') }}" id="phone">
						</div>
						<span class="text-danger" id="error-phone"></span>
					</div>
					<div class="form-group">
						<div class="input-group">
							<span class="input-group-addon"><i class="fa fa-map"></i></span>
							<input type="text" name="lokasi" class="form-control textbox" value="{{ data_c('lokasi') }}" id="lokasi">
						</div>
						<span class="text-danger" id="error-lokasi"></span>
					</div>
					<div class="form-group">
						<div class="input-group">
							<span class="input-group-addon"><i class="fa fa-inbox"></i></span>
							<input type="text" name="email" class="form-control textbox" value="{{ data_c('email') }}" id="email">
						</div>
						<span class="text-danger" id="error-email"></span>
					</div>
				</form>
			</div>
		</div>
	</div>
	
</div>
<div class="row">
	<div class="col-sm-12">
		<div class="m-portlet m-portlet--mobile">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<h3 class="m-portlet__head-text">
							LOKASI
						</h3>
					</div>
				</div>
				<div class="m-portlet__head-tools">
					<button onclick="save('quotes')" class="btn btn-sm btn-accent m-btn--air m-btn--pill "><i class="fa fa-save"></i> Simpan</button>
				</div>
			</div>
			<div class="m-portlet__body">
				<div id="googleMap" style="width:100%;height:380px;"></div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	@foreach(data_c('slide1') as $value => $key)
	<div class="col-sm-4">
		<div class="m-portlet m-portlet--full-height  ">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<span class="m-portlet__head-icon m--hide">
							<i class="la la-gear"></i>
						</span>
						<h3 class="m-portlet__head-text">
							Slide 1
						</h3>

					</div>
				</div>
				<div class="m-portlet__head-tools" id="tools"><button class="btn btn-sm btn-success m-btn m-btn--icon m-btn--pill m-btn--air" id="save_count" type="button" data-toggle="modal" data-target="#slide2"><i class="fa fa-edit"></i> Ubah</button></div>
			</div>
			<div class="m-portlet__body">
				<center>
				<img src="{{ asset('img/'.$value) }}" width="250px">
				</center>
			</div>
		</div>
	</div>
	@endforeach
	@foreach(data_c('slide2') as $value => $key)
	<div class="col-sm-4">
		<div class="m-portlet m-portlet--full-height  ">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<span class="m-portlet__head-icon m--hide">
							<i class="la la-gear"></i>
						</span>
						<h3 class="m-portlet__head-text">
							Slide 2
						</h3>

					</div>
				</div>
				<div class="m-portlet__head-tools" id="tools"><button class="btn btn-sm btn-success m-btn m-btn--icon m-btn--pill m-btn--air" id="save_count" type="button" data-toggle="modal" data-target="#slide2"><i class="fa fa-edit"></i> Ubah</button></div>
			</div>
			<div class="m-portlet__body">
				<center>
				<img src="{{ asset('img/'.$value) }}" width="250px">
				</center>
			</div>
		</div>
	</div>
	@endforeach
	@foreach(data_c('slide3') as $value => $key)
	<div class="col-sm-4">
		<div class="m-portlet m-portlet--full-height  ">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<span class="m-portlet__head-icon m--hide">
							<i class="la la-gear"></i>
						</span>
						<h3 class="m-portlet__head-text">
							Slide 3
						</h3>

					</div>
				</div>
				<div class="m-portlet__head-tools" id="tools"><button class="btn btn-sm btn-success m-btn m-btn--icon m-btn--pill m-btn--air" id="save_count" type="button" data-toggle="modal" data-target="#slide2"><i class="fa fa-edit"></i> Ubah</button></div>
			</div>
			<div class="m-portlet__body">
				<center>
				<img src="{{ asset('img/'.$value) }}" width="250px">
				</center>
			</div>
		</div>
	</div>
	@endforeach
</div>
@endsection
@push('plugin-scripts')
<script src="{{ asset('/datatables/jquery.dataTables.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('/js/tinymce/tinymce.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('/datatables/dataTables.bootstrap4.min.js') }}" type="text/javascript"></script>
<script src="http://maps.googleapis.com/maps/api/js"></script>
<script>
</script>
<script type="text/javascript">
	function save_kontak(type) {
		var valid=true;     
        $('#kontak').find('.textbox').each(function(){
            if (! $(this).val()){
                get_error_text(this);
            } 
            if ($(this).hasClass('no-valid')){
                valid = false;
            }
        });
        if (valid){
    	    $.ajax({
	            type: "post",
	            url: '{{ url('/admin/content/edit') }}',
	            data: {
	            		'_token': '{{ csrf_token() }}',
	            		'type'  : type,
	                    'lokasi': $('#lokasi').val(),
	                    'email' : $('#email').val(),
	                    'phone' : $('#phone').val()
	            	  },
	            success: function(data) {
	            	toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };

                    toastr.success("Data Ter-ubah","Berhasil");
	            },
	            error: function() {
	            	toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };

                    toastr.error("Hubungi Developer","Error");
	            }
	        });
        }

	}

	function save(type) {
		if(tinymce.get('c_'+type).getContent() == 0){
		  swal({title: 'Tidak Boleh Kosong',text: "",type: 'error'})
		}else{
			var isi = tinymce.get('c_'+type).getContent();
			$.ajax({
	            type: "post",
	            url: '{{ url('/admin/content/edit') }}',
	            data: {
	            		'_token': '{{ csrf_token() }}',
	                    'type': type,
	                    'content': isi,
	            	  },
	            success: function(data) {
	            	toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };

                    toastr.success("Data Ter-ubah","Berhasil");
	            },
	            error: function() {
	            	toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };

                    toastr.error("Hubungi Developer","Error");
	            }
	        });
		}
	}

</script>
{{-- agenda --}}
<script src="{{ asset('/js/jquery.twbsPagination.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
	function listagenda() {

	var $pagination = $('#pagination'),
	totalRecords = 0,
	records = [],
	displayRecords = [],
	recPerPage = 10,
	page = 1,
	totalPages = 0;
		$.ajax({
			dataType: 'json',
			method: 'GET',
			url: '{{ url('/admin/listagenda') }}',
			success: function(data){
					records = data;
                  	console.log(records);
                  	totalRecords = records.length;
                  	totalPages = Math.ceil(totalRecords / recPerPage);
                  	apply_pagination()
			},
			error:function() {
				// body...
			}
		});
	}
	function generate_data() {
		var tr;
		$('#agenda_content').html('');
		var d = 
		'<div class="tab-content">'+
			'<div class="tab-pane active" id="m_widget2_tab1_content">'+
				'<div class="m-widget2">'+
					'<div class="m-widget2__item m-widget2__item--primary">'+
						'<div class="m-widget2__checkbox">'+
							'<label class="m-checkbox m-checkbox--solid m-checkbox--single m-checkbox--brand">'+
							'<input type="checkbox">'+
							'<span></span>'+
							'</label>'+
						'</div>'+
						'<div class="m-widget2__desc">'+
							'<span class="m-widget2__text">'+
							'kegiatan'+
							'</span><br>'+
							'<span class="m-widget2__user-name">'+
							'<a href="#" class="m-widget2__link">'+
							'tgl_kegiatan'+
							'</a>'+
							'</span>'+ 
						'</div>'+
						'<div class="m-widget2__actions">'+
							'<div class="m-widget2__actions-nav">'+
								'<div class="m-dropdown m-dropdown--inline m-dropdown--arrow m-dropdown--align-right m-dropdown--align-push" data-dropdown-toggle="hover">'+
									'<a href="#" class="m-dropdown__toggle">'+
										'<i class="la la-ellipsis-h"></i>'+
									'</a>'+
									'<div class="m-dropdown__wrapper">'+
										'<span class="m-dropdown__arrow m-dropdown__arrow--right m-dropdown__arrow--adjust"></span>'+
										'<div class="m-dropdown__inner">'+
											'<div class="m-dropdown__body">'+
												'<div class="m-dropdown__content">'+
													'<button class="btn btn-sm btn-accent m-btn m-btn--icon m-btn--pill m-btn--air" onclick="editdata()" type="button"><i class="fa fa-pencil"></i></button>'+
													'<button class="btn btn-sm btn-danger m-btn m-btn--icon m-btn--pill m-btn--air" type="button" onclick="editdata()"><i class="fa fa-trash"></i></button>'+
												'</div>'+
											'</div>'+
										'</div>'+
									'</div>'+
								'</div>'+
							'</div>'+
						'</div>'+
					'</div>'+
				'</div>'+            
			'</div>'+
		'</div>';
		$('#agenda_content').append(d);
	}
	function apply_pagination() {
		$pagination.twbsPagination({
			totalPages: totalPages,
			visiblePages: 6,
			onPageClick: function (event, page) {
				displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;
				endRec = (displayRecordsIndex) + recPerPage;
				console.log(displayRecordsIndex + 'ssssssssss'+ endRec);
				displayRecords = records.slice(displayRecordsIndex, endRec);
				generate_data();
			}
		});
	}
</script>
{{-- map --}}
</script>

{{-- validasi --}}
<script type="text/javascript">
	$(document).ready(function(){
		listagenda()
		$('.text-danger').hide();
		$('#kontak input').each(function(){ 
	        $(this).blur(function(){ 
	            if (! $(this).val()){
				   get_error_text(this);
	            } else {
	               get_success_text(this);
	            }
	        });
	    });
		function valid_email(email){
			var pola= new RegExp(/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]+$/);
			return pola.test(email);
		}
		function get_error_text(textbox){
			var n = $(textbox).attr('name');
			$(textbox).removeClass('no-valid');
		   	$('#error-'+n).show().text('Kolom tidak boleh kosong');
		}
		function get_success_text(textbox){
			var n = $(textbox).attr('name');
            $(this).addClass('no-valid');
            $('#error-'+n).hide();
		}
		tinymce.init({
	        selector: ".editor",
	        contextmenu: false,
	        plugins: "textcolor link",
	        font_formats: "Sans Serif = arial, helvetica, sans-serif;Serif = times new roman, serif;Fixed Width = monospace;Wide = arial black, sans-serif;Narrow = arial narrow, sans-serif;Comic Sans MS = comic sans ms, sans-serif;Garamond = garamond, serif;Georgia = georgia, serif;Tahoma = tahoma, sans-serif;Trebuchet MS = trebuchet ms, sans-serif;Verdana = verdana, sans-serif",
	        toolbar: "fontselect | fontsizeselect | bold italic underline | forecolor | numlist bullist | alignleft aligncenter alignright alignjustify | outdent indent | link unlink | undo redo"
	    });
	});
</script>

@endpush