@extends('layouts.admin')
@section('title')
Alokasi
@endsection

@push('plugin-styles')
<link href="{{ asset('/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet" type="text/css" />
<style type="text/css">
  .table thead tr th{
    vertical-align: middle;
    text-align: center;
  }
  .table tbody tr td{
    vertical-align: middle;
    text-align: center;
  }

  #m-datatable th, #m-datatable td {
    font-size: 13px;
  }
  .table-hover td {
	cursor: pointer;
  }
</style>
@endpush

@section('content')
<div class="row">
	<div class="col-sm-12">
		<div class="m-portlet m-portlet--info m-portlet--head-solid-bg m-portlet--bordered">
			<div class="m-portlet__head">
				<div class="m-portlet__head-caption">
					<div class="m-portlet__head-title">
						<span class="m-portlet__head-icon m--hide">
							<i class="la la-gear"></i>
						</span>
						<h3 class="m-portlet__head-text">
							Data Teralokasikan
								<small>Zakat Fitrah</small>
						</h3>
					</div>
				</div>
			</div>
			<div class="m-portlet__body">
				<table class="table table-bordered m-table m-table--border-info m-table--head-bg-info" id="data">
					<thead>
						<tr>
							<th>Kode perolehan</th>
							<th>Kode pembagian</th>
							<th>Jenis</th>
							<th>Tanggal</th>
							<th>Aksi</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<div id="modal">
	
</div>

@endsection
@push('plugin-scripts')
<script src="{{ asset('/datatables/jquery.dataTables.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('/datatables/dataTables.bootstrap4.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
	function data(){
		$.get('/admin/alokasi/listfitrah', function(data){
			if(data == 0){
				content = '<tr>'+
		        			'<td colspan="5"> Tidak Ada data </td>'+
		   				  '</tr>';
			    $('#data').append(content);
			}else{
				$.each(data, function (i, value) {
		            content ='<tr id="row_'+value.id+'" style="background-color : rgb(245,245,245)">'+
		            	        '<td>'+value.kode+'</td>'+
		            	        '<td>'+value.count.kode+'</td>'+
		            			'<td>'+value.jenis+'</td>'+
		            			'<td>'+value.created_at+'</td>'+
		            			'<td>'+
		            				'<div class="m-dropdown m-dropdown--inline m-dropdown--small m-dropdown--arrow m-dropdown--align-center" data-dropdown-toggle="hover" aria-expanded="true">'+
										'<a href="#" class="m-dropdown__toggle btn btn-info btn-sm m-btn--air m-btn--pill dropdown-toggle">'+
											'Laporan'+
										'</a>'+
										'<div class="m-dropdown__wrapper">'+
											'<span class="m-dropdown__arrow m-dropdown__arrow--center"></span>'+
											'<div class="m-dropdown__inner">'+
												'<div class="m-dropdown__body">'+
													'<div class="m-dropdown__content">'+
														'<ul class="m-nav">'+
															'<li class="m-nav__section m-nav__section--first">'+
																'<span class="m-nav__section-text">'+
																	'Pilih'+
																'</span>'+
															'</li>'+
															'<li class="m-nav__item">'+
																'<a href="/admin/laporan/fitrah/'+value.id+'" class="m-nav__link">'+
																	'<i class="m-nav__link-icon flaticon-share"></i>'+
																	'<span class="m-nav__link-text">'+
																		'Posting'+
																	'</span>'+
																'</a>'+
															'</li>'+
															'<li class="m-nav__item">'+
																'<a href="/admin/pdf/fitrah/'+value.id+'" class="m-nav__link">'+
																	'<i class="m-nav__link-icon flaticon-share"></i>'+
																	'<span class="m-nav__link-text">'+
																		'Print PDF'+
																	'</span>'+
																'</a>'+
															'</li>'+
														'</ul>'+
													'</div>'+
												'</div>'+
											'</div>'+
										'</div>'+
									'</div>'+
		            			'</td>'+
		       				 '</tr>'+
		       				  '<tr id="row_1'+value.id+'" style="display: none;background-color : rgb(220,220,220)" class="hide'+value.id+'">'+
		       		 			'<td colspan="5"><strong>Detail Pembagian :</strong></td>'+
		       		 		  '</tr>'+
		       		 		  '<tr id="row_2'+value.id+'" style="display: none;background-color : rgb(230,230,230)" class="hide'+value.id+'">'+
		       		 		  	 '<td colspan="2">Mustahik</td>'+
		       		 		  	 '<td></td>'+
		       		 		  	 '<td colspan="2">Jumlah</td>'+
		       		 		  '</tr>'+
		       		 		  '<tr id="row_3'+value.id+'" style="display: none;background-color : rgb(220,220,220)" class="hide'+value.id+'">'+
		       		 			'<td colspan="5"><strong>Detail Perolehan :</strong></td>'+
		       		 		  '</tr>';
		             $('#data').append(content);
		             $.each(value.ket, function(index, obj){
				    		var detail = '<tr class="d_data'+ value.id +'"">'+
				    						'<td colspan="2">'+index+'</td>'+
				    						'<td></td>'+
				    						'<td colspan="2">'+obj+' Orang</td>'+
				    					  '</tr>';
					   		$('#row_2'+ value.id).after(detail);
				   	 });
				   	  $.each(value.count.ket, function(index, obj){
				    		var detail = '<tr class="d_data'+ value.id +'">'+
				    						'<td colspan="2" style="text-align:left;vertical-align: top;"><i class="fa fa-circle-thin"></i> '+index+'</td>'+
				    						'<td colspan="3" id="detail'+value.id+'"></td>'+
				    					  '</tr>';
					   		$('#row_3'+ value.id).after(detail);
					   		$.each(obj, function(i, val){
						    		var det = '<span class="pull-left"><i class="fa fa-circle-thin"></i> '+i+'</span>'+
						    				  '<span class="pull-right">'+val+'</span> <br>';
							   		$('#detail'+ value.id).append(det);
						   	 });
				   	 });
				   	 $('.d_data'+ value.id).hide();
				   	 $('#row_1'+ value.id).addClass('hide'+value.id);

				   	 $('#row_'+value.id).click(function() {
						if($('#row_1'+value.id).hasClass('hide'+value.id)){
					    	$('#row_1'+ value.id).show();
					    	$('#row_2'+ value.id).show();
					    	$('#row_3'+ value.id).show();
	             			$('.d_data'+value.id).show();
	             			$('#row_1'+ value.id).removeClass('hide'+value.id);
	             			$('#row_1'+ value.id).addClass('show'+value.id);
					    }
	             		else if($('#row_1'+value.id).hasClass('show'+value.id)){
	             		    $('#row_1'+ value.id).hide();
	             		    $('#row_2'+ value.id).hide();
	             		    $('#row_3'+ value.id).hide();
	             		    $('.d_data'+value.id).hide();
	             		    $('#row_1'+ value.id).removeClass('show'+value.id);
	             			$('#row_1'+ value.id).addClass('hide'+value.id);
	             		}
						    
					 });
		        });
		    }

		});

		

	}
	
	
	$(document).ready(function(){
		data();
    });

</script>
@endpush